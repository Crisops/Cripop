---
import Layout from '@/layouts/Layout.astro'
import { tmdbUrls } from '@/services/tmdb/urls'
import axiosClient from '@/lib/axios/client'
import MediaDetails from '@/components/astro/media-details.astro'
import type { DetailsSeries } from '@/types/details-serie'
import type { DetailsSeriesSeasons } from '@/types/database.types'

const { serie } = Astro.params

if (!serie) return Astro.redirect('/404')

const [id, name] = serie.split('/')

const URL_SERIE_DETAILS = tmdbUrls.detailsWithVideos('tv', parseInt(id))
const result = await axiosClient.get<DetailsSeries>(URL_SERIE_DETAILS)

if (!result.success) return Astro.redirect('/404')

const { data } = result

const detailsSerie: Omit<DetailsSeriesSeasons, 'currentSeason'> = {
  ...data,
  runtime: data.episode_run_time[0] * data.number_of_episodes,
}
---

<Layout title={`Cripop - ${name}`}>
  <MediaDetails data={detailsSerie} type="tv" />
</Layout>
