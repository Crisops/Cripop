---
import Layout from '@/layouts/Layout.astro'
import type { DetailsMovieId } from '@/types/details-movie-id'
import { tmdbUrls } from '@/services/tmdb/urls'
import axiosClient from '@/lib/axios/client'
import MediaDetails from '@/components/astro/media-details.astro'

const { movie } = Astro.params

if (!movie) return Astro.redirect('/404')

const [id, name] = movie.split('/')

const URL_MOVIE_DETAILS = tmdbUrls.detailsWithVideos('movie', parseInt(id))

const result = await axiosClient.get<DetailsMovieId>(URL_MOVIE_DETAILS)

if (!result.success) return Astro.redirect('/404')

const { data } = result
---

<Layout title={`Cripop - ${name}`}>
  <MediaDetails data={data} type="movie" />
</Layout>
