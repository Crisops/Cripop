---
import Layout from '@/layouts/Layout.astro'
import { tmdbUrls } from '@/services/tmdb/urls'
import { type FormSearch } from '@/utils/validate-rules-form'
import ResultSearch from '@/components/astro/result-search.astro'
import Footer from '@/components/astro/footer.astro'

const urlSearchParams = Astro.url.searchParams
const query = urlSearchParams.get('search')
const type = urlSearchParams.get('type') as FormSearch['type']

let page: number = 1

if (Astro.url.searchParams.get('page') != null) {
  page = Number(Astro.url.searchParams.get('page'))
} else {
  page = 1
}

if (!query || !type) return

const URL_SEARCH = tmdbUrls.search(type, query, page)
---

<Layout
  title={`${query} - Cripop`}
  description={`Mostramos los resultados más relevantes para tu búsqueda en Cripop. Explora entre diferentes tipos de contenido relacionados con "${query}".`}
  og={{
    url: '/result',
    image: '/images/og/result.jpg',
  }}
>
  <ResultSearch
    type={type}
    url={URL_SEARCH}
    page={page}
    title="Resultados de tu busqueda"
    description={`Mostramos los resultados más relevantes para tu búsqueda en Cripop. Explora entre diferentes tipos de contenido relacionados con "${query}".`}
  />
  <Footer />
</Layout>
