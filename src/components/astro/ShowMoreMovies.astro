---

  // Renderiza todas las peliculas que hay en cartelera


  import Filters from "../react/Filters";
  import type { Genders, MovieWithGenders } from "@/types/Genders"
  import type { Movies } from "@/types/dataMovie";
  import { getGendersMoviesList } from "@/services/get_genders";
  import { getGendersMovies } from "@/services/get_genders_list";
  import ShowMovie from "./ShowMovie.astro";


  const API_KEY = import.meta.env.SECRET_API_KEY
  const ACCESS_TOKEN = import.meta.env.SECRET_TOKEN_ACCESS



  const URL_NOW_PLAYING: string = `https://api.themoviedb.org/3/movie/now_playing?api_key=${API_KEY}language=es&page=2`
  const URL_IMG: string = 'https://image.tmdb.org/t/p/w780'

  const options = {
    method: 'GET',
    headers: {
      accept: 'application/json',
      Authorization: `Bearer ${ACCESS_TOKEN}`
    }
  };

  const response = await fetch(URL_NOW_PLAYING, options)

  const movies = await response.json() as Movies

  const movie_gendersId = movies.results.map(movie => movie.genre_ids)

  const gendersList = await getGendersMoviesList(ACCESS_TOKEN) as Genders

  const listIdWithGender = await getGendersMovies(movie_gendersId, gendersList) as MovieWithGenders


  
---


<main class="relative w-full overflow-hidden pt-40">
  <div class="relative px-10 flex items-center flex-col xl:flex-row justify-between">
    <h1 class="text-white font-Libre_Franklin text-3xl text-center sm:text-left lg:max-xl:text-center xl:text-left md font-bold">Pel√≠culas recientes</h1>
    <div class="flex flex-wrap items-center pt-10 gap-10 justify-start lg:max-xl:justify-center xl:justify-start px-10 xl:pt-0">
      <Filters/>
    </div>
  </div>
  <div id="containerMovies" class="relative h-full mt-10">
    <div class="relative grid place-items-center grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-5 px-10 pb-20">
      {
        movies.results.map((movie, index) =>(
          <ShowMovie
            id={movie.id}
            url_image={URL_IMG + movie.poster_path}
            title={movie.title}
            widht={400}
            height={500}
            genders={listIdWithGender}
            rate={movie.vote_average}
            index={index}
          />
        ))
      }
    </div>
  </div>
</main>


<style>
  
  #containerMovies::-webkit-scrollbar{
    width: 5px;
  }

  #containerMovies::-webkit-scrollbar-thumb{
    background-color: #003B07;
    border-radius: 10px;
  }

  #containerMovies::-webkit-scrollbar-track{
    background-color: #000105;
  }

</style>
